<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="AfterBuild">
    <Message Importance="high" Text="Collecting Package Content Files"/>
    <CallTarget Targets="CopyPackageContentFiles"/>
  </Target>

  <Target Name="CopyPackageContentFiles">
    <ItemGroup>
      <PackageReferenceContentFiles
        Condition="%(PackageReference.IncludeAssets) == 'all'"
        Include="$(NugetPackageRoot)%(PackageReference.Identity)\%(PackageReference.Version)\contentfiles\any\any\**\*.*" />
      <PackageReferenceSerializationFiles
        Condition="%(PackageReference.IncludeAssets) == 'all'"
        Include="$(NugetPackageRoot)%(PackageReference.Identity)\%(PackageReference.Version)\yml\**\*.*" />
    </ItemGroup>
    
    <Copy
      SourceFiles="@(PackageReferenceContentFiles)"
      DestinationFiles="@(PackageReferenceContentFiles->'$(MSBuildProjectDirectory)\%(RecursiveDir)%(Filename)%(Extension)')"
    />
    <Copy
      SourceFiles="@(PackageReferenceSerializationFiles)"
      DestinationFiles="@(PackageReferenceSerializationFiles->'$(MSBuildProjectDirectory)\..\..\..\..\%(RecursiveDir)%(Filename)%(Extension)')"
    />
  </Target>


</Project>